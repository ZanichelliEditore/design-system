import {html} from "lit-html";
import {styleMap} from "lit-html/directives/style-map.js";
import {Meta, Story, Canvas, ArgsTable} from "@storybook/addon-docs";
import "./index";
import "./index.stories.css";
import {SortDirection, VisibilityCondition} from "../../../beans";

<Meta
  title="ZTable"
  component="z-table"
  args={{
    "bordered": true,
    "--z-table--cells-padding": "16px",
  }}
/>

# ZTable

<Canvas>
  <Story name="ZTable">
    {(args) => html`<z-table
      class="z-table-demo"
      .bordered=${args.bordered}
      style=${styleMap({
        "--z-table--cells-padding": args["--z-table--cells-padding"],
      })}
    >
      <z-thead>
        <z-tr>
          <z-th>Titolo colonna</z-th>
          <z-th>Titolo colonna</z-th>
          <z-th>Titolo colonna</z-th>
          <z-th>Titolo colonna</z-th>
          <z-th>Titolo colonna</z-th>
          <z-th>Titolo colonna</z-th>
          <z-th>Titolo colonna</z-th>
          <z-th>Titolo colonna</z-th>
        </z-tr>
      </z-thead>
      <z-tbody>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
      </z-tbody>
      <z-tfoot>
        <z-tr>
          <z-td colspan="8">Table footer</z-td>
        </z-tr>
      </z-tfoot>
    </z-table>`}
  </Story>
</Canvas>

## Expandable rows

Just set `expandable` prop on the `z-tr` element to make it expandable, then put an additional `z-td` as extended content.

If you put a clickable item as a child cell of a z-tr with `expandable` set to `true`, you need to set a "prevent-expand" class on that item, in order to prevent unwanted row expansions.

<Canvas>
  <Story name="Expandable rows">
    {(args) => html`<z-table
      class="z-table-demo"
      .bordered=${args.bordered}
      style=${styleMap({
        "--z-table--cells-padding": args["--z-table--cells-padding"],
      })}
    >
      <z-thead>
        <z-tr>
          <z-th>Colonna 1</z-th>
          <z-th>Colonna 2</z-th>
          <z-th>Colonna 3</z-th>
          <z-th>Colonna 4</z-th>
          <z-th>Colonna 5</z-th>
          <z-th>Colonna 6</z-th>
          <z-th>Colonna 7</z-th>
          <z-th>Colonna 8</z-th>
        </z-tr>
      </z-thead>
      <z-tbody>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td show-menu>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div></z-td
          >
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr expandable>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>
            <span>Contenuto cella</span>
            <z-button
              class="prevent-expand"
              onclick="alert('button clicked without expanding the row')"
              icon="plus"
              size="x-small"
            ></z-button
          ></z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto espanso</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr expandable>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto espanso</z-td>
        </z-tr>
      </z-tbody>
      <z-tfoot>
        <z-tr>
          <z-td colspan="8">Table footer</z-td>
        </z-tr>
      </z-tfoot>
    </z-table>`}
  </Story>
</Canvas>

## Sticky

To make a column sticky, you need to set the `sticky` prop on the `z-th` and/or `z-td` elements of the same column.
For the header or footer, just set the `sticky` prop on the `z-thead` or `z-tfoot` element.

<Canvas>
  <Story
    name="Sticky"
    args={{
      stickyHeader: true,
      stickyFooter: true,
      stickFirstColumn: true,
    }}
  >
    {(args) => html`<z-table
      class="z-table-demo"
      .bordered=${args.bordered}
      style=${styleMap({
        "--z-table--cells-padding": args["--z-table--cells-padding"],
        "height": "400px",
      })}
    >
      <z-thead .sticky=${args.stickyHeader}>
        <z-tr>
          <z-th .sticky=${args.stickFirstColumn}>Colonna 1</z-th>
          <z-th>Colonna 2</z-th>
          <z-th>Colonna 3</z-th>
          <z-th>Colonna 4</z-th>
          <z-th>Colonna 5</z-th>
          <z-th>Colonna 6</z-th>
          <z-th>Colonna 7</z-th>
          <z-th>Colonna 8</z-th>
        </z-tr>
      </z-thead>
      <z-tbody>
        <z-tr>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td show-menu>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div></z-td
          >
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr expandable>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>
            <span>Contenuto cella</span>
            <z-button
              class="prevent-expand"
              onclick="alert('button clicked')"
              icon="plus"
              size="x-small"
            ></z-button
          ></z-td>
          <z-td>Contenuto espanso</z-td>
        </z-tr>
        <z-tr expandable>
          <z-td .sticky=${args.stickFirstColumn}>Contenuto cella 1</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto espanso</z-td>
        </z-tr>
      </z-tbody>
      <z-tfoot .sticky=${args.stickyFooter}>
        <z-tr>
          <z-td colspan="8">Table footer</z-td>
        </z-tr>
      </z-tfoot>
    </z-table>`}
  </Story>
</Canvas>

## Cells with contextual menu

Use the `showMenu` prop on `z-td` or `z-th`, setting a value of the enum `VisibilityCondition` (`HOVER` or `ALWAYS`), to show a contextual menu button on the cell. The content of the menu must be placed using the slot `contextual-menu`.

<Canvas>
  <Story
    name="Cells with contextual menu"
    argTypes={{
      showMenu: {
        control: {
          type: "inline-radio",
          labels: {
            null: "hidden",
          },
        },
        options: [null, ...Object.values(VisibilityCondition)],
      },
    }}
    args={{
      showMenu: VisibilityCondition.HOVER,
    }}
  >
    {(args) => html`<z-table
      class="z-table-demo"
      .bordered=${args.bordered}
      style=${styleMap({
        "--z-table--cells-padding": args["--z-table--cells-padding"],
      })}
    >
      <z-thead>
        <z-tr>
          <z-th>Colonna 1</z-th>
          <z-th .showMenu=${args.showMenu}>
            Heading con menu
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-th>
          <z-th>Colonna 2</z-th>
        </z-tr>
      </z-thead>
      <z-tbody>
        <z-tr>
          <z-td .showMenu=${args.showMenu}>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-td>
          <z-td>Contenuto cella</z-td>
          <z-td .showMenu=${args.showMenu}>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-td>
        </z-tr>
        <z-tr>
          <z-td .showMenu=${args.showMenu}>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-td>
          <z-td>Contenuto cella</z-td>
          <z-td .showMenu=${args.showMenu}>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-td>
        </z-tr>
        <z-tr>
          <z-td .showMenu=${args.showMenu}>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-td>
          <z-td>Contenuto cella</z-td>
          <z-td .showMenu=${args.showMenu}>
            <span>Contenuto cella con menu</span>
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-td>
        </z-tr>
      </z-tbody>
    </z-table>`}
  </Story>
</Canvas>

## Sort action

Set the `sortDirection` prop to `SortDirection.ASC` or `SortDirection.DESC` to enable sorting and show the sort button.
Clicking the button will fire the `sort` event with the `sortDirection` as detail.

<Canvas>
  <Story name="Sort action">
    {(args) => html`<z-table
      class="z-table-demo"
      .bordered=${args.bordered}
      style=${styleMap({
        "--z-table--cells-padding": args["--z-table--cells-padding"],
      })}
    >
      <z-thead>
        <z-tr>
          <z-th>Colonna 1</z-th>
          <z-th
            .sortDirection=${SortDirection.ASC}
            .showMenu=${VisibilityCondition.HOVER}
          >
            Colonna 2 con menu e sorting
            <div slot="contextual-menu">Contenuto del popover</div>
          </z-th>
          <z-th .sortDirection=${SortDirection.DESC}>Colonna 3 con sorting</z-th>
        </z-tr>
      </z-thead>
      <z-tbody>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
        <z-tr>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
          <z-td>Contenuto cella</z-td>
        </z-tr>
      </z-tbody>
    </z-table>`}
  </Story>
</Canvas>

## Accessibility

The `ZTable` and its related components comes with a set of roles and ARIA attributes to help screen readers to understand the table structure and its content. The roles are mainly used to identify the table parts, since they are not the native HTML table elements. The ARIA attributes used are the following:

- [`aria-sort`](https://www.w3.org/TR/wai-aria-1.1/#aria-sort) to identify the sorting direction of a column when sorting is enabled
- [`aria-expanded`](https://www.w3.org/TR/wai-aria-1.1/#aria-expanded) to identify if a row is expanded or not when expandable rows are enabled. The attribute is set on the button that expands the row, as explained in the [docs](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-expanded)
- [`aria-controls`](https://www.w3.org/TR/wai-aria-1.1/#aria-controls) is used on the expandable row button to identify the content that is controlled by the button itself, as explained in the [docs](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-controls). Maybe the `aria-owns` attribute were more appropriate, but it is not supported on MacOS and iOS with VoiceOver, so we used `aria-controls` instead.
- [`aria-label`](https://www.w3.org/TR/wai-aria-1.1/#aria-label) is used on the expandable row button to provide a label for the button, since the button doesn't have any text content.

<ArgsTable of="z-table" />
