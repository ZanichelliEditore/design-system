{"version":3,"names":["stylesCss","ZFileUploadStyle0","ZFileUpload","this","inputAttributes","type","id","multiple","ZFileUploadType","DEFAULT","removeFileListener","e","files","file","find","name","detail","fileName","index","indexOf","splice","fileDroppedListener","input","fileInputHandler","componentDidUpdate","handleAccessibility","invalidFiles","size","errorModal","focus","componentWillLoad","Map","length","checkFiles","Array","from","getFiles","getType","getDevice","Device","DESKTOP","DESKTOP_WIDE","lastFile","el","querySelector","button","uploadLink","errors","sizeErrorString","fileMaxSize","formatErrorString","forEach","fileSize","fileFormatOk","acceptedFormat","split","some","ext","toLowerCase","endsWith","trim","fileSizeOk","f","push","fileInput","emit","value","set","get","renderTitle","h","mainTitle","renderDescription","cssClass","class","description","renderAllowedFileExtensions","fileFormatString","fileWeightString","fileFormat","map","string","substring","toUpperCase","join","finalString","renderFileSection","DividerSize","MEDIUM","renderInput","Object","assign","onChange","accept","ref","val","renderUploadButton","onClick","click","onKeyPress","code","preventDefault","variant","buttonVariant","icon","uploadBtnLabel","renderUploadLink","tabIndex","renderDefaultMode","renderDragDropMode","dragAndDropLabel","key","bothErrors","_a","_b","handleErrorModalContent","slot","render","Host","modalid","modaltitle","onModalClose","onModalBackgroundClick"],"sources":["src/components/file-upload/z-file-upload/styles.css?tag=z-file-upload&encapsulation=shadow","src/components/file-upload/z-file-upload/index.tsx"],"sourcesContent":[":host {\n  color: var(--color-text01);\n  font-family: var(--font-family-sans);\n  font-weight: var(--font-rg);\n}\n\n:host > .container {\n  display: flex;\n  flex-direction: column;\n}\n\n:host .modal-wrapper {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: calc(var(--space-unit) * 2);\n}\n\n:host .modal-wrapper > .files-wrapper {\n  display: flex;\n  flex-direction: column;\n  margin: calc(var(--space-unit) * 4);\n  gap: var(--space-unit);\n}\n\n:host .text-container {\n  display: flex;\n  flex-direction: column;\n  margin: auto;\n}\n\n:host .text-container .body-1 {\n  text-align: center;\n}\n\n:host .text-container .upload-link {\n  color: var(--color-link-primary);\n  cursor: pointer;\n}\n\n:host .text-container .upload-link-text {\n  margin-bottom: var(--space-unit);\n}\n\ninput#file-elem {\n  display: none;\n}\n\n#title {\n  display: inline-block;\n  margin: calc(var(--space-unit) * 2.5) 0 calc(var(--space-unit) * 4);\n  font-size: calc(var(--space-unit) * 3);\n  font-weight: var(--font-sb);\n}\n\n:host > .container > z-button {\n  display: inline-block;\n  margin-top: calc(var(--space-unit) * 3);\n}\n\n:host > .container > .files-container.hidden {\n  display: none;\n}\n\n:host > .container > .files-container > .heading-4-sb {\n  display: inline-block;\n  margin: calc(var(--space-unit) * 3) 0;\n  font-size: calc(var(--space-unit) * 2);\n  font-weight: var(--font-sb);\n}\n\n:host([type=\"dragdrop\"]) > .container > .files-container > .heading-4-sb {\n  margin-top: 0;\n  margin-bottom: calc(var(--space-unit) * 3);\n}\n\n:host > .container > .files-container > .files-wrapper {\n  display: flex;\n  flex-wrap: wrap;\n  column-gap: calc(var(--space-unit) * 2);\n  row-gap: calc(var(--space-unit) * 2);\n}\n\n:host > .container > .files-container > z-divider {\n  margin-top: calc(var(--space-unit) * 3);\n  margin-bottom: 0;\n}\n\n:host([type=\"dragdrop\"]) > .container > .files-container > z-divider {\n  margin: calc(var(--space-unit) * 3) 0;\n}\n\n/* Tablet breakpoint */\n@media only screen and (min-width: 768px) {\n  :host > .container > z-button {\n    align-self: flex-start;\n  }\n\n  :host .modal-wrapper {\n    padding: calc(var(--space-unit) * 3);\n  }\n}\n\n@media only screen and (min-width: 1152px) {\n  :host .modal-wrapper {\n    padding: calc(var(--space-unit) * 4);\n  }\n}\n","import {Component, Prop, h, EventEmitter, Event, State, Listen, Element, Host, Method} from \"@stencil/core\";\nimport {ButtonVariant, Device, DividerSize, ZFileUploadType} from \"../../../beans\";\nimport {getDevice} from \"../../../utils/utils\";\n\n@Component({\n  tag: \"z-file-upload\",\n  styleUrl: \"styles.css\",\n  shadow: true,\n})\nexport class ZFileUpload {\n  /** Prop indicating the file upload type - can be default or dragdrop */\n  @Prop({reflect: true})\n  type: ZFileUploadType = ZFileUploadType.DEFAULT;\n\n  /** Prop indicating the button variant*/\n  @Prop()\n  buttonVariant?: ButtonVariant;\n\n  /** Prop indicating the accepted file type: ex \".pdf, .doc, .jpg\" */\n  @Prop()\n  acceptedFormat?: string;\n\n  /** Max file dimension in Megabyte */\n  @Prop()\n  fileMaxSize?: number;\n\n  /** Title */\n  @Prop()\n  mainTitle?: string;\n\n  /** Description */\n  @Prop()\n  description?: string;\n\n  /** Files added by the user */\n  @State()\n  files: File[] = [];\n\n  /** upoload button label */\n  @Prop()\n  uploadBtnLabel?: string = \"allega\";\n\n  /** drag & drop button label */\n  @Prop()\n  dragAndDropLabel?: string = \"Rilascia i file in questa area per allegarli.\";\n\n  /** List of files not allowed to be uploaded */\n  @State()\n  invalidFiles: Map<string, string[]>;\n\n  @Element() el: HTMLZFileUploadElement;\n\n  private input: HTMLInputElement;\n\n  private button: HTMLZButtonElement;\n\n  private errorModal: HTMLZModalElement;\n\n  private uploadLink: HTMLSpanElement;\n\n  private inputAttributes = {\n    type: \"file\",\n    id: \"file-elem\",\n    multiple: true,\n  };\n\n  /** Listen removeFile event sent from z-file component */\n  @Listen(\"removeFile\")\n  removeFileListener(e: CustomEvent): void {\n    const files = this.files;\n    const file = files.find((file) => file.name === e.detail.fileName);\n    if (file) {\n      const index = files.indexOf(file);\n      if (index >= 0) {\n        files.splice(index, 1);\n        this.files = [...files];\n      }\n    }\n  }\n\n  /** Listen fileDropped event sent from z-dragdrop-area component */\n  @Listen(\"fileDropped\")\n  fileDroppedListener(e: CustomEvent): void {\n    this.input.files = e.detail;\n    this.fileInputHandler();\n  }\n\n  componentDidUpdate(): void {\n    this.handleAccessibility();\n    this.invalidFiles.size && this.errorModal.focus();\n  }\n\n  componentWillLoad(): void {\n    this.invalidFiles = new Map<string, string[]>();\n  }\n\n  /** Emitted when user select one or more files */\n  @Event()\n  fileInput: EventEmitter;\n\n  private fileInputHandler(): void {\n    if (this.input.files.length) {\n      this.invalidFiles = this.checkFiles(Array.from(this.input.files));\n    }\n  }\n\n  /** get array of uploaded files */\n  @Method()\n  async getFiles(): Promise<File[]> {\n    return this.files;\n  }\n\n  private getType(): ZFileUploadType {\n    if (getDevice() !== Device.DESKTOP && getDevice() !== Device.DESKTOP_WIDE) {\n      return ZFileUploadType.DEFAULT;\n    }\n\n    return this.type;\n  }\n\n  private handleAccessibility(): void {\n    const lastFile = this.el.querySelector(\"z-file:last-child z-chip button\");\n    if (this.files.length > 0 && lastFile) {\n      (lastFile as HTMLElement).focus();\n    } else {\n      this.getType() === ZFileUploadType.DEFAULT\n        ? this.button.querySelector(\"button\").focus()\n        : this.uploadLink.focus();\n    }\n  }\n\n  private checkFiles(files: File[]): Map<string, string[]> {\n    const errors = new Map<string, string[]>();\n    const sizeErrorString = `supera il limite di ${this.fileMaxSize}MB`;\n    const formatErrorString = \" ha un'estensione non prevista\";\n    files.forEach((file: File) => {\n      const fileSize = file.size / 1024 / 1024;\n      const fileFormatOk = this.acceptedFormat\n        .split(\",\")\n        .some((ext: string) => file.name.toLowerCase().endsWith(ext.trim()));\n      const fileSizeOk = fileSize <= this.fileMaxSize;\n      if (fileSizeOk && fileFormatOk) {\n        if (!this.files.find((f) => f.name === file.name)) {\n          this.files.push(file);\n          this.fileInput.emit(file);\n          this.input.value = \"\";\n        }\n\n        return;\n      }\n      errors.set(file.name, []);\n      if (!fileSizeOk) {\n        errors.get(file.name).push(sizeErrorString);\n      }\n      if (!fileFormatOk) {\n        errors.get(file.name).push(formatErrorString);\n      }\n    });\n\n    return errors;\n  }\n\n  private renderTitle(): HTMLElement {\n    return <span id=\"title\">{this.mainTitle}</span>;\n  }\n\n  private renderDescription(cssClass): HTMLElement {\n    return <span class={cssClass}>{this.description}</span>;\n  }\n\n  private renderAllowedFileExtensions(): HTMLElement {\n    let fileFormatString = \"\";\n    let fileWeightString = \"\";\n\n    if (this.acceptedFormat) {\n      const fileFormat = this.acceptedFormat\n        .split(\", \")\n        .map((string) => string.substring(1).toUpperCase())\n        .join(\", \");\n      fileFormatString = ` nei formati ${fileFormat}`;\n    }\n\n    if (this.fileMaxSize) {\n      fileWeightString = ` per un massimo di ${this.fileMaxSize}MB di peso`;\n    }\n\n    const finalString = `Puoi allegare file${fileFormatString}${fileWeightString}.`;\n\n    return <span class=\"body-3\">{fileFormatString || fileWeightString ? finalString : null}</span>;\n  }\n\n  private renderFileSection(): HTMLElement {\n    return (\n      <section class={`files-container ${!this.files.length ? \"hidden\" : \"\"}`}>\n        <span class=\"heading-4-sb\">File appena caricati</span>\n        <div class=\"files-wrapper\">\n          <slot name=\"files\" />\n        </div>\n        <z-divider size={DividerSize.MEDIUM} />\n      </section>\n    );\n  }\n\n  private renderInput(): HTMLInputElement {\n    return (\n      <input\n        {...this.inputAttributes}\n        onChange={() => this.fileInputHandler()}\n        accept={this.acceptedFormat}\n        ref={(val) => (this.input = val)}\n      />\n    );\n  }\n\n  private renderUploadButton(): unknown[] {\n    return [\n      this.renderInput(),\n      <z-button\n        onClick={() => this.input.click()}\n        onKeyPress={(e) => {\n          if (e.code == \"Space\" || e.code == \"Enter\") {\n            e.preventDefault();\n            this.input.click();\n          }\n        }}\n        id=\"fileSelect\"\n        variant={this.buttonVariant}\n        icon=\"upload\"\n        ref={(val) => (this.button = val)}\n      >\n        {this.uploadBtnLabel}\n      </z-button>,\n    ];\n  }\n\n  private renderUploadLink(): unknown[] {\n    return [\n      this.renderInput(),\n      <span class=\"body-1 upload-link-text\">\n        Trascina o{\" \"}\n        <span\n          tabIndex={0}\n          class=\"body-1-sb upload-link\"\n          onClick={() => this.input.click()}\n          onKeyPress={(e) => {\n            if (e.code == \"Space\" || e.code == \"Enter\") {\n              e.preventDefault();\n              this.input.click();\n            }\n          }}\n          ref={(val) => (this.uploadLink = val)}\n        >\n          carica\n        </span>{\" \"}\n        dal tuo computer\n      </span>,\n    ];\n  }\n\n  private renderDefaultMode(): unknown[] {\n    return [\n      this.renderDescription(\"body-3-sb\"),\n      this.renderAllowedFileExtensions(),\n      this.renderFileSection(),\n      this.renderUploadButton(),\n    ];\n  }\n\n  private renderDragDropMode(): unknown[] {\n    return [\n      this.renderFileSection(),\n      <z-dragdrop-area drag-and-drop-label={this.dragAndDropLabel}>\n        <div class=\"text-container\">\n          {this.renderDescription(\"body-1\")}\n          {this.renderUploadLink()}\n          {this.renderAllowedFileExtensions()}\n        </div>\n      </z-dragdrop-area>,\n    ];\n  }\n\n  private formatErrorString(key, value): string {\n    const bothErrors = value[0] && value[1] ? \", ed \" : \"\";\n\n    return `Il file ${key} ${value[0] ?? \"\"}${bothErrors}${value[1] ?? \"\"}.`;\n  }\n\n  private handleErrorModalContent(): HTMLDivElement {\n    return (\n      <div slot=\"modalContent\">\n        <div class=\"modal-wrapper\">\n          <div class=\"files\">\n            {Array.from(this.invalidFiles).map(([key, value]) => {\n              return <span class=\"body-3\">{this.formatErrorString(key, value)}</span>;\n            })}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  render(): HTMLZFileUploadElement {\n    return (\n      <Host>\n        <div\n          tabIndex={0}\n          class={`container ${this.getType()}`}\n        >\n          {this.mainTitle && this.renderTitle()}\n          {this.getType() == ZFileUploadType.DEFAULT ? this.renderDefaultMode() : this.renderDragDropMode()}\n        </div>\n        {!!this.invalidFiles.size && (\n          <z-modal\n            modalid={`file-upload-${this.type}-error-modal`}\n            tabIndex={0}\n            ref={(val) => (this.errorModal = val)}\n            modaltitle=\"Attenzione\"\n            onModalClose={() => (this.invalidFiles = new Map<string, string[]>())}\n            onModalBackgroundClick={() => (this.invalidFiles = new Map<string, string[]>())}\n          >\n            {this.handleErrorModalContent()}\n          </z-modal>\n        )}\n      </Host>\n    );\n  }\n}\n"],"mappings":"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"}