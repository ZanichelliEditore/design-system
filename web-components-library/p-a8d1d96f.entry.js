import{r as i,c as e,h as l,H as t,g as a}from"./p-d17ebc2f.js";import{x as s,q as n,D as o}from"./p-9f80c0b8.js";import{g as r}from"./p-87fdd14f.js";import"./p-d69e14fb.js";const c=class{constructor(l){i(this,l),this.fileInput=e(this,"fileInput",7),this.type=s.DEFAULT,this.files=[],this.inputAttributes={type:"file",id:"file-elem",multiple:!0}}removeFileListener(i){const e=this.files,l=e.find((e=>e.name===i.detail.fileName));if(l){const i=e.indexOf(l);i>=0&&(e.splice(i,1),this.files=[...e])}}fileDroppedListener(i){this.input.files=i.detail,this.fileInputHandler()}componentDidUpdate(){this.handleAccessibility(),this.invalidFiles.size&&this.errorModal.focus()}componentWillLoad(){this.invalidFiles=new Map,this.type===s.DRAGDROP&&r()!==n.DESKTOP&&(this.type=s.DEFAULT)}fileInputHandler(){this.input.files.length&&(this.invalidFiles=this.checkFiles(Array.from(this.input.files)))}async getFiles(){return this.files}handleAccessibility(){this.files.length>0?this.el.querySelector("z-file:last-child z-chip button").focus():this.type===s.DEFAULT?this.button.shadowRoot.querySelector("button").focus():this.uploadLink.focus()}checkFiles(i){const e=new Map,l=`supera i ${this.fileMaxSize}MB`;return i.forEach((i=>{const t=i.size/1024/1024,a=this.acceptedFormat.split(",").some((e=>i.name.toLowerCase().endsWith(e.trim()))),s=t<=this.fileMaxSize;s&&a?this.files.find((e=>e.name===i.name))||(this.files.push(i),this.fileInput.emit(i),this.input.value=""):(e.set(i.name,[]),s||e.get(i.name).push(l),a||e.get(i.name).push(" ha un'estensione non prevista"))})),e}renderTitle(){return l("z-heading",{id:"title",variant:"semibold",level:2},this.mainTitle)}renderDescription(i,e){return l("z-body",{variant:i,level:e},this.description)}renderAllowedFileExtensions(){let i="",e="";return this.acceptedFormat&&(i=` nei formati ${this.acceptedFormat.split(", ").map((i=>i.substring(1).toUpperCase())).join(", ")}`),this.fileMaxSize&&(e=` per un massimo di ${this.fileMaxSize}MB di peso`),l("z-body",{level:3},i||e?`Puoi allegare file${i}${e}.`:null)}renderFileSection(){if(this.files.length)return this.files.length>0&&l("section",{class:"files-container"},l("z-heading",{variant:"semibold",level:4},"File appena caricati"),l("div",{class:"files"},l("slot",{name:"files"})),l("z-divider",{size:o.MEDIUM}))}renderInput(){return l("input",Object.assign({},this.inputAttributes,{onChange:()=>this.fileInputHandler(),accept:this.acceptedFormat,ref:i=>this.input=i}))}renderUploadButton(){return[this.renderInput(),l("z-button",{onClick:()=>this.input.click(),onKeyPress:i=>{"Space"!=i.code&&"Enter"!=i.code||(i.preventDefault(),this.input.click())},id:"fileSelect",variant:this.buttonVariant,icon:"upload",ref:i=>this.button=i},"Allega")]}renderUploadLink(){return[this.renderInput(),l("z-body",{class:"upload-link-text",variant:"regular",level:1},"Trascinalo qui o"," ",l("z-body",{tabIndex:0,class:"upload-link",onClick:()=>this.input.click(),onKeyPress:i=>{"Space"!=i.code&&"Enter"!=i.code||(i.preventDefault(),this.input.click())},variant:"semibold",level:1,ref:i=>this.uploadLink=i},"caricalo")," ","dal tuo computer")]}renderDefaultMode(){return[this.renderDescription("semibold",3),this.renderAllowedFileExtensions(),this.renderFileSection(),this.renderUploadButton()]}renderDragDropMode(){return[this.renderFileSection(),l("z-dragdrop-area",null,l("div",{class:"text-container"},this.renderDescription("regular",1),this.renderUploadLink(),this.renderAllowedFileExtensions()))]}formatErrorString(i,e){var l,t;return`Il file ${i} ${null!==(l=e[0])&&void 0!==l?l:""}${e[0]&&e[1]?", ":""} ${null!==(t=e[1])&&void 0!==t?t:""} e non puÃ² quindi essere caricato.`}handleErrorModalContent(){return l("div",{slot:"modalContent"},l("div",{class:"modal-wrapper"},l("div",{class:"files"},Array.from(this.invalidFiles).map((([i,e])=>l("z-body",{variant:"regular",level:3},this.formatErrorString(i,e)))))))}render(){return l(t,null,l("div",{tabIndex:0,class:`container ${this.type}`},this.renderTitle(),this.type==s.DEFAULT?this.renderDefaultMode():this.renderDragDropMode()),!!this.invalidFiles.size&&l("z-modal",{tabIndex:0,ref:i=>this.errorModal=i,modaltitle:"Attenzione",onModalClose:()=>this.invalidFiles=new Map,onModalBackgroundClick:()=>this.invalidFiles=new Map},this.handleErrorModalContent()))}get el(){return a(this)}};c.style=".sc-z-file-upload-h{color:var(--color-text01);font-family:var(--font-family-sans);font-weight:var(--font-rg)}.sc-z-file-upload-h>.container.sc-z-file-upload{display:flex;flex-direction:column}.sc-z-file-upload-h .modal-wrapper.sc-z-file-upload{display:flex;align-items:center;justify-content:center}.sc-z-file-upload-h .modal-wrapper.sc-z-file-upload>.files.sc-z-file-upload{display:flex;flex-direction:column;margin:calc(var(--space-unit) * 4);gap:var(--space-unit)}.sc-z-file-upload-h .text-container.sc-z-file-upload{display:flex;flex-direction:column;margin:auto}.sc-z-file-upload-h .text-container.sc-z-file-upload z-body.sc-z-file-upload{text-align:center}.sc-z-file-upload-h .text-container.sc-z-file-upload .upload-link.sc-z-file-upload{color:var(--color-link-primary);cursor:pointer}.sc-z-file-upload-h .text-container.sc-z-file-upload .upload-link-text.sc-z-file-upload{margin-bottom:var(--space-unit)}input#file-elem.sc-z-file-upload{display:none}#title.sc-z-file-upload{display:inline-block;margin-bottom:var(--space-unit)}.sc-z-file-upload-h>.container.sc-z-file-upload>z-button.sc-z-file-upload{display:inline-block;margin-top:calc(var(--space-unit) * 3)}.sc-z-file-upload-h>.container.sc-z-file-upload>.files-container.sc-z-file-upload>z-heading.sc-z-file-upload{display:inline-block;margin:calc(var(--space-unit) * 3) 0}.sc-z-file-upload-h>.container.sc-z-file-upload>.files-container.sc-z-file-upload>.files.sc-z-file-upload{display:flex;flex-wrap:wrap;column-gap:calc(var(--space-unit) * 2);row-gap:calc(var(--space-unit) * 2)}.sc-z-file-upload-h>.container.sc-z-file-upload>.files-container.sc-z-file-upload>z-divider.sc-z-file-upload{margin-top:calc(var(--space-unit) * 3);margin-bottom:0}@media only screen and (min-width: 768px){.sc-z-file-upload-h>.container.sc-z-file-upload>z-button.sc-z-file-upload{align-self:flex-start}}";export{c as z_file_upload}